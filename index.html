<!DOCTYPE html>
<html>
<head>
  <title>China Steel Map - Final</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    #searchContainer {
      position: absolute;
      top: 60px;
      left: 60px;
      z-index: 9999;
      background-color: white;
      padding: 6px;
      border-radius: 6px;
      width: 260px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    #searchInput {
      width: 100%;
      padding: 4px;
      font-size: 14px;
    }
    #suggestions {
      display: none;
      border: 1px solid #ccc;
      background: white;
      max-height: 150px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
<div id="map"></div>
<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Search steel mill...">
  <div id="suggestions"></div>
</div>

<script>
var map = L.map('map').setView([34.5, 105], 5);
L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png', {
  attribution: 'Map tiles by Stamen Design, OpenStreetMap',
  maxZoom: 18
}).addTo(map);

// Steel mills
const mills = [
  { name: "Baosteel", lat: 31.3, lon: 121.5 },
  { name: "Rizhao Steel", lat: 35.4, lon: 119.5 },
  { name: "Shougang Group", lat: 39.9, lon: 116.3 }
];

mills.forEach(m => {
  m.marker = L.marker([m.lat, m.lon]).addTo(map)
    .bindPopup("<b>" + m.name + "</b>")
    .bindTooltip(m.name);
});

// Ports
const ports = [
  { name: "Port of Shanghai", lat: 31.4, lon: 121.8 },
  { name: "Port of Tianjin", lat: 39.0, lon: 117.7 },
  { name: "Port of Guangzhou", lat: 23.1, lon: 113.3 }
];

ports.forEach(p => {
  L.circleMarker([p.lat, p.lon], {
    radius: 6,
    color: "blue",
    fillColor: "#33f",
    fillOpacity: 0.8
  }).addTo(map).bindPopup("<b>" + p.name + "</b>").bindTooltip(p.name);
});

// Province capitals
const capitals = [
  { name: "Beijing", lat: 39.9042, lon: 116.4074 },
  { name: "Shanghai", lat: 31.2304, lon: 121.4737 },
  { name: "Guangzhou", lat: 23.1291, lon: 113.2644 },
  { name: "Wuhan", lat: 30.5928, lon: 114.3055 },
  { name: "Chengdu", lat: 30.5728, lon: 104.0668 }
];

capitals.forEach(c => {
  L.marker([c.lat, c.lon]).addTo(map)
    .bindPopup("<b>" + c.name + "</b>")
    .bindTooltip(c.name);
});

// Search logic
const input = document.getElementById("searchInput");
const suggestionsBox = document.getElementById("suggestions");

input.addEventListener("input", () => {
  const val = input.value.trim().toLowerCase();
  suggestionsBox.innerHTML = "";
  if (!val) {
    suggestionsBox.style.display = "none";
    return;
  }
  const matches = mills.filter(m => m.name.toLowerCase().includes(val));
  matches.forEach(m => {
    const div = document.createElement("div");
    div.textContent = m.name;
    div.style.padding = "4px";
    div.style.cursor = "pointer";
    div.onmouseover = () => div.style.background = "#eee";
    div.onmouseout = () => div.style.background = "white";
    div.onclick = () => {
      map.setView([m.lat, m.lon], 8);
      if (m.marker) m.marker.openPopup();
      input.value = "";
      suggestionsBox.innerHTML = "";
      suggestionsBox.style.display = "none";
    };
    suggestionsBox.appendChild(div);
  });
  suggestionsBox.style.display = matches.length ? "block" : "none";
});

document.addEventListener("click", (e) => {
  if (!input.contains(e.target)) {
    suggestionsBox.style.display = "none";
  }
});
</script>
</body>
</html>
